# Turin Grad Hub - Backend API Endpoints

Этот документ содержит полный список endpoint'ов, необходимых для создания backend системы Turin Grad Hub.

## Обзор системы

Turin Grad Hub - система управления выпускниками Туринского политехнического университета Ташкента (TTPU) со следующими ролями пользователей:
- **Admin** - полное управление системой
- **Teacher** - управление своими студентами и отчеты
- **Student** - просмотр профиля, преподавателей и однокурсников

## Основные сущности

- **User** - пользователи системы (админы, преподаватели, студенты)
- **WorkExperience** - опыт работы студентов
- **EducationGoal** - образовательные цели студентов
- **TeacherStudent** - связи преподаватель-студент
- **ActivityLog** - логи активности в системе

---

## 1. АУТЕНТИФИКАЦИЯ И АВТОРИЗАЦИЯ

### 1.1 Вход в систему
```
POST /api/auth/login
```
**Описание:** Аутентификация пользователя по email, телефону или студенческому ID  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "identifier": "email@example.com | +998901234567 | 12345678",
  "password": "password123"
}
```
**Ответ:**
```json
{
  "success": true,
  "user": {
    "id": "user_id",
    "firstName": "Имя",
    "lastName": "Фамилия",
    "email": "email@example.com",
    "role": "admin|teacher|student",
    "avatar": "url",
    "lastLogin": "2025-01-15T08:00:00Z"
  },
  "token": "jwt_token",
  "refreshToken": "refresh_token"
}
```

### 1.2 Выход из системы
```
POST /api/auth/logout
```
**Описание:** Выход пользователя из системы  
**Аутентификация:** Bearer Token  
**Тело запроса:**
```json
{
  "refreshToken": "refresh_token"
}
```

### 1.3 Регистрация нового пользователя
```
POST /api/auth/register
```
**Описание:** Регистрация нового студента в системе  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "firstName": "Имя",
  "lastName": "Фамилия", 
  "middleName": "Отчество",
  "email": "email@example.com",
  "phone": "+998901234567",
  "studentId": "12345678",
  "password": "password123",
  "faculty": "Факультет",
  "direction": "Направление"
}
```

### 1.4 SMS верификация
```
POST /api/auth/verify-sms
```
**Описание:** Подтверждение номера телефона через SMS код  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "phone": "+998901234567",
  "code": "123456"
}
```

### 1.5 Отправка SMS кода
```
POST /api/auth/send-sms
```
**Описание:** Отправка SMS кода на номер телефона  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "phone": "+998901234567"
}
```

### 1.6 Обновление токена
```
POST /api/auth/refresh
```
**Описание:** Обновление JWT токена через refresh token  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "refreshToken": "refresh_token"
}
```

### 1.7 Сброс пароля
```
POST /api/auth/forgot-password
```
**Описание:** Запрос на сброс пароля  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "identifier": "email@example.com | +998901234567"
}
```

### 1.8 Подтверждение сброса пароля
```
POST /api/auth/reset-password
```
**Описание:** Установка нового пароля  
**Аутентификация:** Не требуется  
**Тело запроса:**
```json
{
  "token": "reset_token",
  "newPassword": "new_password123"
}
```

---

## 2. УПРАВЛЕНИЕ ПОЛЬЗОВАТЕЛЯМИ (ADMIN)

### 2.1 Получить список всех пользователей
```
GET /api/admin/users
```
**Описание:** Получение списка всех пользователей с фильтрацией  
**Аутентификация:** Bearer Token (только admin)  
**Параметры запроса:**
- `page` (number): номер страницы
- `limit` (number): количество записей на странице  
- `search` (string): поиск по имени, email, studentId
- `role` (string): фильтр по роли (admin|teacher|student)
- `faculty` (string): фильтр по факультету
- `verified` (boolean): фильтр по статусу верификации

### 2.2 Получить информацию о пользователе
```
GET /api/admin/users/:id
```
**Описание:** Получение детальной информации о пользователе  
**Аутентификация:** Bearer Token (только admin)

### 2.3 Создать нового пользователя
```
POST /api/admin/users
```
**Описание:** Создание нового пользователя администратором  
**Аутентификация:** Bearer Token (только admin)  
**Тело запроса:**
```json
{
  "firstName": "Имя",
  "lastName": "Фамилия",
  "middleName": "Отчество",
  "email": "email@example.com",
  "phone": "+998901234567",
  "role": "admin|teacher|student",
  "studentId": "12345678",
  "faculty": "Факультет",
  "direction": "Направление",
  "password": "password123"
}
```

### 2.4 Обновить пользователя
```
PUT /api/admin/users/:id
```
**Описание:** Обновление информации о пользователе  
**Аутентификация:** Bearer Token (только admin)

### 2.5 Удалить пользователя
```
DELETE /api/admin/users/:id
```
**Описание:** Удаление пользователя из системы  
**Аутентификация:** Bearer Token (только admin)

### 2.6 Верифицировать пользователя
```
PATCH /api/admin/users/:id/verify
```
**Описание:** Подтверждение верификации пользователя  
**Аутентификация:** Bearer Token (только admin)

### 2.7 Заблокировать/разблокировать пользователя
```
PATCH /api/admin/users/:id/block
```
**Описание:** Блокировка или разблокировка пользователя  
**Аутентификация:** Bearer Token (только admin)  
**Тело запроса:**
```json
{
  "blocked": true,
  "reason": "Причина блокировки"
}
```

---

## 3. УПРАВЛЕНИЕ СТУДЕНТАМИ

### 3.1 Получить список студентов
```
GET /api/students
```
**Описание:** Получение списка студентов  
**Аутентификация:** Bearer Token  
**Доступ:** admin, teacher (только свои студенты)  
**Параметры запроса:**
- `page`, `limit`, `search`, `faculty`, `direction`
- `admissionYear` (number): год поступления
- `graduationYear` (number): год выпуска
- `financingType` (string): budget|contract

### 3.2 Получить информацию о студенте
```
GET /api/students/:id
```
**Описание:** Получение детальной информации о студенте  
**Аутентификация:** Bearer Token  
**Доступ:** admin, teacher (только свои студенты), сам студент

### 3.3 Обновить информацию о студенте
```
PUT /api/students/:id
```
**Описание:** Обновление информации студента  
**Аутентификация:** Bearer Token  
**Доступ:** admin, сам студент

### 3.4 Получить студентов преподавателя
```
GET /api/teachers/:teacherId/students
```
**Описание:** Получение списка студентов конкретного преподавателя  
**Аутентификация:** Bearer Token  
**Доступ:** admin, сам преподаватель

---

## 4. УПРАВЛЕНИЕ ПРЕПОДАВАТЕЛЯМИ

### 4.1 Получить список преподавателей
```
GET /api/teachers
```
**Описание:** Получение списка преподавателей  
**Аутентификация:** Bearer Token  
**Параметры запроса:** `page`, `limit`, `search`, `faculty`

### 4.2 Получить информацию о преподавателе
```
GET /api/teachers/:id
```
**Описание:** Получение информации о преподавателе  
**Аутентификация:** Bearer Token

### 4.3 Обновить информацию преподавателя
```
PUT /api/teachers/:id
```
**Описание:** Обновление информации преподавателя  
**Аутентификация:** Bearer Token  
**Доступ:** admin, сам преподаватель

### 4.4 Назначить студентов преподавателю
```
POST /api/teachers/:teacherId/students
```
**Описание:** Назначение студентов преподавателю  
**Аутентификация:** Bearer Token (только admin)  
**Тело запроса:**
```json
{
  "studentIds": ["student1", "student2", "student3"]
}
```

### 4.5 Удалить студента у преподавателя
```
DELETE /api/teachers/:teacherId/students/:studentId
```
**Описание:** Удаление студента у преподавателя  
**Аутентификация:** Bearer Token (только admin)

---

## 5. ПРОФИЛЬ ПОЛЬЗОВАТЕЛЯ

### 5.1 Получить свой профиль
```
GET /api/profile
```
**Описание:** Получение информации о текущем пользователе  
**Аутентификация:** Bearer Token

### 5.2 Обновить свой профиль
```
PUT /api/profile
```
**Описание:** Обновление информации профиля  
**Аутентификация:** Bearer Token

### 5.3 Загрузить аватар
```
POST /api/profile/avatar
```
**Описание:** Загрузка аватара пользователя  
**Аутентификация:** Bearer Token  
**Тип:** multipart/form-data
**Поля:** `avatar` (файл изображения)

### 5.4 Загрузить CV/резюме
```
POST /api/profile/cv
```
**Описание:** Загрузка CV пользователя  
**Аутентификация:** Bearer Token  
**Тип:** multipart/form-data
**Поля:** `cv` (PDF файл)

### 5.5 Загрузить диплом
```
POST /api/profile/diploma
```
**Описание:** Загрузка диплома студента  
**Аутентификация:** Bearer Token  
**Тип:** multipart/form-data
**Поля:** `diploma` (PDF или изображение)

---

## 6. ОПЫТ РАБОТЫ

### 6.1 Получить опыт работы
```
GET /api/profile/work-experience
```
**Описание:** Получение списка опыта работы пользователя  
**Аутентификация:** Bearer Token

### 6.2 Добавить опыт работы
```
POST /api/profile/work-experience
```
**Описание:** Добавление нового опыта работы  
**Аутентификация:** Bearer Token  
**Тело запроса:**
```json
{
  "company": "Название компании",
  "position": "Должность",
  "startDate": "2023-01-01",
  "endDate": "2024-01-01",
  "description": "Описание работы"
}
```

### 6.3 Обновить опыт работы
```
PUT /api/profile/work-experience/:id
```
**Описание:** Обновление существующего опыта работы  
**Аутентификация:** Bearer Token

### 6.4 Удалить опыт работы
```
DELETE /api/profile/work-experience/:id
```
**Описание:** Удаление опыта работы  
**Аутентификация:** Bearer Token

---

## 7. ОБРАЗОВАТЕЛЬНЫЕ ЦЕЛИ

### 7.1 Получить образовательные цели
```
GET /api/profile/education-goals
```
**Описание:** Получение списка образовательных целей  
**Аутентификация:** Bearer Token

### 7.2 Добавить образовательную цель
```
POST /api/profile/education-goals
```
**Описание:** Добавление новой образовательной цели  
**Аутентификация:** Bearer Token  
**Тело запроса:**
```json
{
  "year": 2025,
  "goal": "Получить степень магистра"
}
```

### 7.3 Обновить образовательную цель
```
PUT /api/profile/education-goals/:id
```
**Описание:** Обновление образовательной цели  
**Аутентификация:** Bearer Token

### 7.4 Удалить образовательную цель
```
DELETE /api/profile/education-goals/:id
```
**Описание:** Удаление образовательной цели  
**Аутентификация:** Bearer Token

---

## 8. АНАЛИТИКА И СТАТИСТИКА (ADMIN)

### 8.1 Получить общую статистику
```
GET /api/admin/analytics/overview
```
**Описание:** Получение общей статистики системы  
**Аутентификация:** Bearer Token (только admin)  
**Ответ:**
```json
{
  "totalStudents": 2847,
  "activeTeachers": 156,
  "graduates": 1234,
  "companies": 89,
  "trends": {
    "studentsGrowth": 12,
    "teachersGrowth": 3,
    "graduatesGrowth": 8,
    "companiesGrowth": 15
  }
}
```

### 8.2 Получить статистику по факультетам
```
GET /api/admin/analytics/faculties
```
**Описание:** Статистика по факультетам  
**Аутентификация:** Bearer Token (только admin)

### 8.3 Получить географическую статистику
```
GET /api/admin/analytics/geography
```
**Описание:** Распределение выпускников по регионам  
**Аутентификация:** Bearer Token (только admin)

### 8.4 Получить статистику трудоустройства
```
GET /api/admin/analytics/employment
```
**Описание:** Статистика трудоустройства выпускников  
**Аутентификация:** Bearer Token (только admin)

### 8.5 Получить статистику по годам
```
GET /api/admin/analytics/yearly
```
**Описание:** Статистика поступления и выпуска по годам  
**Аутентификация:** Bearer Token (только admin)  
**Параметры запроса:**
- `startYear` (number): начальный год
- `endYear` (number): конечный год

---

## 9. ОТЧЕТЫ

### 9.1 Создать отчет
```
POST /api/reports
```
**Описание:** Создание нового отчета  
**Аутентификация:** Bearer Token  
**Доступ:** admin, teacher  
**Тело запроса:**
```json
{
  "title": "Название отчета",
  "type": "student_progress|faculty_statistics|employment_report",
  "parameters": {
    "facultyId": "faculty_id",
    "year": 2024,
    "studentIds": ["student1", "student2"]
  }
}
```

### 9.2 Получить список отчетов
```
GET /api/reports
```
**Описание:** Получение списка отчетов  
**Аутентификация:** Bearer Token  
**Параметры запроса:**
- `page`, `limit`, `type`, `createdBy`

### 9.3 Получить отчет
```
GET /api/reports/:id
```
**Описание:** Получение конкретного отчета  
**Аутентификация:** Bearer Token

### 9.4 Скачать отчет
```
GET /api/reports/:id/download
```
**Описание:** Скачивание отчета в формате PDF/Excel  
**Аутентификация:** Bearer Token  
**Параметры запроса:**
- `format` (string): pdf|excel

### 9.5 Удалить отчет
```
DELETE /api/reports/:id
```
**Описание:** Удаление отчета  
**Аутентификация:** Bearer Token  
**Доступ:** admin, создатель отчета

---

## 10. ЛОГИ АКТИВНОСТИ

### 10.1 Получить логи активности
```
GET /api/admin/activity-logs
```
**Описание:** Получение логов активности системы  
**Аутентификация:** Bearer Token (только admin)  
**Параметры запроса:**
- `page`, `limit`, `userId`, `action`, `startDate`, `endDate`

### 10.2 Создать лог активности
```
POST /api/activity-logs
```
**Описание:** Создание записи в логе активности  
**Аутентификация:** Bearer Token (внутренний endpoint)  
**Тело запроса:**
```json
{
  "action": "USER_CREATED",
  "targetId": "target_id",
  "targetType": "user",
  "details": "Описание действия"
}
```

---

## 11. ФАЙЛЫ И МЕДИА

### 11.1 Загрузить файл
```
POST /api/files/upload
```
**Описание:** Загрузка файла в систему  
**Аутентификация:** Bearer Token  
**Тип:** multipart/form-data
**Поля:** `file`, `type` (avatar|cv|diploma|document)

### 11.2 Получить файл
```
GET /api/files/:id
```
**Описание:** Получение файла по ID  
**Аутентификация:** Bearer Token (проверка прав доступа)

### 11.3 Удалить файл
```
DELETE /api/files/:id
```
**Описание:** Удаление файла  
**Аутентификация:** Bearer Token

---

## 12. СПРАВОЧНИКИ

### 12.1 Получить список факультетов
```
GET /api/dictionaries/faculties
```
**Описание:** Получение списка факультетов  
**Аутентификация:** Bearer Token

### 12.2 Создать факультет
```
POST /api/dictionaries/faculties
```
**Описание:** Создание нового факультета (только администраторы)  
**Аутентификация:** Bearer Token (только admin)  
**Тело запроса:**
```json
{
  "name": "Название факультета",
  "description": "Описание факультета"
}
```

### 12.3 Обновить факультет
```
PUT /api/dictionaries/faculties/:id
```
**Описание:** Обновление существующего факультета (только администраторы)  
**Аутентификация:** Bearer Token (только admin)  
**Тело запроса:**
```json
{
  "name": "Новое название факультета",
  "description": "Новое описание факультета"
}
```

### 12.4 Удалить факультет
```
DELETE /api/dictionaries/faculties/:id
```
**Описание:** Удаление факультета (только администраторы)  
**Аутентификация:** Bearer Token (только admin)  
**Внимание:** Это также удалит все связанные направления

### 12.5 Получить список направлений
```
GET /api/dictionaries/directions
```
**Описание:** Получение списка направлений обучения  
**Аутентификация:** Bearer Token  
**Параметры запроса:**
- `facultyId` (string): фильтр по факультету

### 12.6 Получить список компаний
```
GET /api/dictionaries/companies
```
**Описание:** Получение списка компаний-работодателей  
**Аутентификация:** Bearer Token

### 12.7 Добавить компанию
```
POST /api/dictionaries/companies
```
**Описание:** Добавление новой компании  
**Аутентификация:** Bearer Token  
**Тело запроса:**
```json
{
  "name": "Название компании",
  "website": "https://company.com",
  "industry": "IT",
  "location": "Ташкент"
}
```

---

## 13. УВЕДОМЛЕНИЯ

### 13.1 Получить уведомления
```
GET /api/notifications
```
**Описание:** Получение уведомлений пользователя  
**Аутентификация:** Bearer Token  
**Параметры запроса:**
- `page`, `limit`, `read`, `type`

### 13.2 Отметить как прочитанное
```
PATCH /api/notifications/:id/read
```
**Описание:** Отметка уведомления как прочитанного  
**Аутентификация:** Bearer Token

### 13.3 Отметить все как прочитанные
```
PATCH /api/notifications/mark-all-read
```
**Описание:** Отметка всех уведомлений как прочитанных  
**Аутентификация:** Bearer Token

### 13.4 Отправить уведомление
```
POST /api/admin/notifications
```
**Описание:** Отправка уведомления пользователям  
**Аутентификация:** Bearer Token (только admin)  
**Тело запроса:**
```json
{
  "title": "Заголовок",
  "message": "Текст уведомления",
  "type": "info|warning|success|error",
  "recipients": ["user1", "user2"],
  "recipientType": "all|role|specific"
}
```

---

## 14. ПОИСК

### 14.1 Глобальный поиск
```
GET /api/search
```
**Описание:** Поиск по всей системе  
**Аутентификация:** Bearer Token  
**Параметры запроса:**
- `q` (string): поисковый запрос
- `type` (string): users|students|teachers|companies
- `page`, `limit`

### 14.2 Поиск студентов
```
GET /api/search/students
```
**Описание:** Поиск студентов с расширенными фильтрами  
**Аутентификация:** Bearer Token  
**Параметры запроса:**
- `q`, `faculty`, `direction`, `admissionYear`, `graduationYear`, `company`

---

## 15. ИМПОРТ/ЭКСПОРТ

### 15.1 Импорт пользователей
```
POST /api/admin/import/users
```
**Описание:** Импорт пользователей из Excel/CSV файла  
**Аутентификация:** Bearer Token (только admin)  
**Тип:** multipart/form-data
**Поля:** `file` (Excel/CSV файл)

### 15.2 Экспорт пользователей
```
GET /api/admin/export/users
```
**Описание:** Экспорт пользователей в Excel/CSV  
**Аутентификация:** Bearer Token (только admin)  
**Параметры запроса:**
- `format` (string): excel|csv
- `role`, `faculty`, `verified`

### 15.3 Получить шаблон импорта
```
GET /api/admin/import/template
```
**Описание:** Скачивание шаблона для импорта  
**Аутентификация:** Bearer Token (только admin)  
**Параметры запроса:**
- `type` (string): users|students|teachers

---

## 16. СИСТЕМНЫЕ ENDPOINTS

### 16.1 Проверка здоровья системы
```
GET /api/health
```
**Описание:** Проверка состояния API  
**Аутентификация:** Не требуется

### 16.2 Информация о системе
```
GET /api/info
```
**Описание:** Информация о версии API  
**Аутентификация:** Не требуется

### 16.3 Конфигурация клиента
```
GET /api/config
```
**Описание:** Получение конфигурации для фронтенда  
**Аутентификация:** Bearer Token

---

## Общие принципы

### Коды ответов HTTP
- `200` - Успешный запрос
- `201` - Ресурс создан
- `400` - Ошибка в запросе
- `401` - Не авторизован
- `403` - Доступ запрещен
- `404` - Ресурс не найден
- `422` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### Формат ошибок
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "details": [
      {
        "field": "email",
        "message": "Email is required"
      }
    ]
  }
}
```

### Пагинация
Стандартные параметры для endpoints с пагинацией:
- `page` (number, default: 1): номер страницы
- `limit` (number, default: 20, max: 100): количество записей

Ответ с пагинацией:
```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 150,
    "totalPages": 8
  }
}
```

### Фильтрация и сортировка
- `sort` (string): поле для сортировки
- `order` (string): asc|desc
- Поля фильтрации зависят от конкретного endpoint'а

---

## Итого: 87 endpoints

Эта документация содержит полный список endpoints, необходимых для реализации backend системы Turin Grad Hub, включая аутентификацию, управление пользователями, аналитику, отчеты и все вспомогательные функции.
